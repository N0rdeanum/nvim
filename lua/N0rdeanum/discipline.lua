--[[

  –ú–æ–¥—É–ª—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è —Ä–µ–∂–∏–º–∞ "–ö–æ–≤–±–æ–π"

  –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
  require('cowboy-config').cowboy()

  –≠—Ç–æ—Ç –º–æ–¥—É–ª—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è —Ä–µ–∂–∏–º–∞ "–ö–æ–≤–±–æ–π", –∑–∞–±–∞–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä–∞—è —Ä–µ–∞–≥–∏—Ä—É–µ—Ç
  –Ω–∞ —á—Ä–µ–∑–º–µ—Ä–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–∂–∞—Ç–∏–π –∫–ª–∞–≤–∏—à —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (h, j, k, l, +, –∏–ª–∏ -) —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
  —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç, –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –ª—é–±—É—é –∏–∑ —ç—Ç–∏—Ö –∫–ª–∞–≤–∏—à –±–æ–ª–µ–µ 10 —Ä–∞–∑ –∑–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª –≤ 2 —Å–µ–∫—É–Ω–¥—ã.

  –§—É–Ω–∫—Ü–∏–∏:
  - M.cowboy(): –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Ä–µ–∂–∏–º–∞ "–ö–æ–≤–±–æ–π".

  –ü—Ä–∏–º–µ—Ä:
  local cowboyConfig = require('cowboy-config')
  cowboyConfig.cowboy()

--]]

local M = {}

--- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Ä–µ–∂–∏–º–∞ "–ö–æ–≤–±–æ–π".
function M.cowboy()
  ---@type table? id - –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.
  local id
  local ok = true

  --- –ü–µ—Ä–µ–±–∏—Ä–∞–µ—Ç —É–∫–∞–∑–∞–Ω–Ω—ã–µ –∫–ª–∞–≤–∏—à–∏ –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–ª–∞–≤–∏—à.
  for _, key in ipairs({ "h", "j", "k", "l", "+", "-" }) do
    local count = 0
    local timer = assert(vim.loop.new_timer())
    local map = key

    -- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–ª–∞–≤–∏—à–∏ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–π –∫–ª–∞–≤–∏—à–∏.
    vim.keymap.set("n", key, function()
      if vim.v.count > 0 then
        count = 0
      end

      -- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ 10, –∏ –≤—ã–∑—ã–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ.
      if count >= 10 then
        ok, id = pcall(vim.notify, "–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω —Ä–µ–∂–∏–º '–ö–æ–≤–±–æ–π'! ü§†", vim.log.levels.WARN, {
          icon = "ü§™",
          replace = id,
          keep = function()
            return count >= 10
          end,
        })

        -- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.
        if not ok then
          id = nil
          return map
        end
      else
        count = count + 1

        -- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Ç–∞–π–º–µ—Ä –¥–ª—è —Å–±—Ä–æ—Å–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ—Å–ª–µ 2 —Å–µ–∫—É–Ω–¥.
        timer:start(2000, 0, function()
          count = 0
        end)

        return map
      end
    end, { expr = true, silent = true })
  end
end

return M
